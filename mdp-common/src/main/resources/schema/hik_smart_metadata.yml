---
name: hik-mdp-data-collector
properties:
  kafka.bootstrap.servers: 10.17.148.7:9092
  kafka.zookeeper.connector: 10.17.148.7:2181
  hbase.zookeeper.quorum: 10.17.148.7
  hbase.zookeeper.property.clientPort: 2181
  hbase.table.name: HIK_MDP_CELLPHONE
  # policeHash: Hash分配, policeAvg: 平均分配
  hbase.region.strategy: policeAvg
  rowkey.expression: hashFormatAndInsert(formatTime(timestamp_,'yyyyMM')+formatString(target_type,'%03d')+formatTime(timestamp_,'dd')+'_'+global_id,999,0,'%03d',6)
  collector.parser: pb
  db.url: jdbc:postgresql:///mdp
  db.username: postgres
  db.password: postgres
schemas:
  - name: hik_mdp_cellphone_schema
    fields:
      - name: yys
        group: info
        index: 0
        # INT8, INT16, INT32, INT64, FLOAT32, FLOAT64, BOOLEAN, STRING, BYTES, ARRAY
        type: STRING
        optional: false
        parameters:
          index.type: es
          index.isStore: false
          index.isTokenized: false
      - name: ywlx
        group: info
        index: 1
        type: STRING
        optional: true
        parameters:
          index.type: es
          index.isStore: false
          index.isTokenized: false
      - name: qssj
        group: info
        index: 2
        type: STRING
        optional: true
        parameters:
          index.type: es
          index.isStore: false
          index.isTokenized: false
      - name: fwhm
        group: info
        index: 3
        type: STRING
        optional: true
        parameters:
          index.type: es
          index.isStore: false
          index.isTokenized: false
      - name: kh
        group: info
        index: 4
        type: STRING
        optional: true
      - name: sbhm
        group: info
        index: 5
        type: FLOAT32
        optional: true
      - name: dfhm
        group: info
        index: 6
        type: FLOAT32
        optional: true
      - name: dfhmgsd
        group: info
        index: 7
        type: INT32
        optional: true
      - name: thsc
        group: info
        index: 8
        type: INT64
        optional: true
      - name: hjlx
        group: info
        index: 9
        type: INT64
        optional: true
      - name: lac
        group: info
        index: 10
        type: INT32
        optional: true
      - name: cid
        group: info
        index: 11
        type: INT64
        optional: true
        parameters:
          index.type: es
          index.isStore: true
          index.isTokenized: false
      - name: fwhmjz
        group: info
        index: 12
        type: INT32
        optional: true
        parameters:
          index.type: es
          index.isStore: false
          index.isTokenized: false
      - name: msc
        group: info
        index: 13
        type: STRING
        optional: true
      - name: cs
        group: info
        index: 14
        type: STRING
        optional: true
      - name: dsfhm
        group: info
        index: 15
        type: STRING
        optional: true
      - name: dsfhmgsd
        group: info
        index: 16
        type: INT32
        optional: true
topics:
  - name: hik_mdp_cellphone_topic
    partitions: 10
    replicas: 1
    schema: hik_mdp_cellphone_schema
    properties:
          cleanup.policy: delete
  - name: test
    partitions: 10
    replicas: 1
    schema: test
    properties:
          cleanup.policy: delete

connectors:
  # 批量写HBase和Kafka
  - name: hik_mdp_cellphone_topic
    className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.DAGConnectorImpl
    parals: 1
    properties:
      connector.resources.cores: 1
      connector.resources.memory.mb: 2048
      max.record.buffer.size: 2000
    dispatcher:
      className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.DAGDispatcherImpl
      properties:
        max.idle.time.ms: 60000
    from:
          className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.KafkaPoller
          properties:
            converter: com.hikvision.bigdata.hbp.datacollectors.connector.v2.converter.impl.DefaultKafkaConverterImpl
            topic: hik_mdp_cellphone_topic
            schema: hik_mdp_cellphone_schema
            max.commit.retries: 60000
    #        consumer.properties:
    #          bootstrap.servers: hdh249:9092
    #          zookeeper.connector: hdh249:2181
    #          group.id: hik_mac_info_lin_test2
        to:
          processors:
            - name: sendtohbase
              className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.SendToHBaseProcessor
              properties:
                metrics.prefix: sendtoHikMacInfo
                table: hik_mdp_cellphone
                hbase.conf:
                  hbase.zookeeper.quorum: lark001:2181
            - name: sendtohbasesi
              className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.SendToHBaseProcessor
              properties:
                metrics.prefix: sendtoHikMacIndexInfo
                table: ssdTable:hik_mac_index_info
                hbase.conf:
                  hbase.zookeeper.quorum: lark001:2181
                converter: com.hikvision.bigdata.hbp.datacollectors.connector.v2.converter.impl.HBaseSecondaryIndexConverterImpl
              waitFor:
                - sendtohbase
            - name: sendtoes
              className: com.hikvision.bigdata.hbp.datacollectors.connector.v2.dag.impl.SendToElasticSearchWithJestProcessor
              properties:
                index: hik_mac_index_info
                type: hikmacindexinfotype
                router: DATE_FIELD
                router.field: collect_time
                router.rules: day:1
                router.rules.locale: zh-cn
                router.rules.timezone: GMT
                es.rest.addresses: lark001:9200
              waitFor:
                - sendtohbasesi